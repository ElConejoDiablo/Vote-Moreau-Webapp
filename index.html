<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campaign Actions - QR Codes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1a5490;
            --primary-dark: #0d3a6b;
            --text: #1a1a1a;
            --text-light: #666;
            --bg: #ffffff;
            --bg-light: #f5f5f5;
            --border: #e0e0e0;
            --focus: #0066cc;
            --error: #d32f2f;
            --success: #2e7d32;

            /* Glassmorphic colors */
            --glass-white: rgba(255, 255, 255, 0.7);
            --glass-white-strong: rgba(255, 255, 255, 0.9);
            --glass-border: rgba(255, 255, 255, 0.3);
            --glass-shadow: rgba(0, 0, 0, 0.08);

            /* Background gradients */
            --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #e8eef5 100%);
            --accent-glow: rgba(26, 84, 144, 0.15);

            /* Depth shadows */
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.04);
            --shadow-md: 0 8px 32px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 20px 60px rgba(0, 0, 0, 0.12);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-gradient);
            color: var(--text);
            line-height: 1.5;
            padding: 1rem;
            padding-bottom: 2rem;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: "";
            position: fixed;
            inset: 0;
            pointer-events: none;
            background-image: radial-gradient(circle at 0 0, rgba(255, 255, 255, 0.3) 0, transparent 50%),
                              radial-gradient(circle at 100% 100%, rgba(26, 84, 144, 0.18) 0, transparent 55%);
            opacity: 0.7;
            z-index: -2;
        }

        body::after {
            content: "";
            position: fixed;
            inset: -50px;
            pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 160 160' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.08'/%3E%3C/svg%3E");
            opacity: 0.35;
            z-index: -1;
        }

        .page-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 0.75rem 1rem;
            border-radius: 999px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0.3));
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-md), inset 0 1px 0 rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(18px);
            -webkit-backdrop-filter: blur(18px);
        }

        .page-header h1 {
            font-size: 1.75rem;
            margin: 0;
            color: var(--primary);
            text-align: left;
            font-weight: 700;
            text-shadow: 0 1px 0 rgba(255, 255, 255, 0.7);
        }

        .language-toggle {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .language-toggle-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 32px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.1));
            border: 1px solid var(--glass-border);
            box-shadow: 0 4px 12px var(--glass-shadow), inset 0 1px 0 rgba(255, 255, 255, 0.6);
            transition: background 0.3s ease, box-shadow 0.3s ease;
            border-radius: 32px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 24px;
            width: 24px;
            left: 4px;
            bottom: 4px;
            background: radial-gradient(circle at 30% 30%, #ffffff, #dfe9f5);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.16);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider {
            background: linear-gradient(135deg, rgba(26, 84, 144, 0.9), rgba(26, 84, 144, 0.7));
            box-shadow: 0 6px 18px rgba(26, 84, 144, 0.45);
        }

        .toggle-switch input:focus + .toggle-slider {
            outline: 3px solid var(--focus);
            outline-offset: 2px;
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(28px);
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 1rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .sections {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .action-section {
            background: transparent;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0.5rem 0 0.75rem;
            color: var(--primary-dark);
        }

        .action-card {
            background: var(--bg);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            min-height: 180px;
        }

        .action-card:hover,
        .action-card:focus {
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
            outline: none;
        }

        .action-card:focus {
            outline: 3px solid var(--focus);
            outline-offset: 2px;
        }

        .action-icon {
            width: 80px;
            height: 80px;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
        }

        .action-icon svg {
            width: 100%;
            height: 100%;
        }

        .action-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text);
            line-height: 1.3;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(60px);
            -webkit-backdrop-filter: blur(60px);
            z-index: 1000;
            overflow-y: auto;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--glass-white-strong);
            border-radius: 20px;
            padding: 1.5rem;
            max-width: 90vw;
            width: 100%;
            max-width: 500px;
            position: relative;
            margin: auto;
            box-shadow: var(--shadow-lg), inset 0 1px 0 rgba(255, 255, 255, 0.7);
            border: 1px solid var(--glass-border);
            transform: translateY(24px) scale(0.97);
            opacity: 0;
            transition: transform 260ms cubic-bezier(0.68, -0.55, 0.265, 1.55), opacity 200ms ease-out;
        }

        .modal.active .modal-content {
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text);
            flex: 1;
            margin-right: 1rem;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text);
            cursor: pointer;
            padding: 0.25rem 0.5rem;
            line-height: 1;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .close-btn:hover,
        .close-btn:focus {
            background: var(--bg-light);
            outline: 2px solid var(--focus);
            outline-offset: 2px;
        }

        .modal-qr-container {
            display: flex;
            justify-content: center;
            margin-bottom: 1.5rem;
            background: #ffffff;
            padding: 1rem;
            border-radius: 16px;
            touch-action: pan-x pan-y pinch-zoom;
            box-shadow: var(--shadow-sm);
        }

        .modal-qr {
            width: 90%;
            max-width: 400px;
            height: auto;
            image-rendering: crisp-edges;
        }

        .modal-url {
            font-size: 0.875rem;
            color: var(--text-light);
            word-break: break-all;
            margin-bottom: 1.5rem;
            padding: 0.75rem;
            background: var(--bg-light);
            border-radius: 4px;
        }

        .modal-actions {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .btn {
            padding: 0.75rem 1rem;
            border-radius: 999px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.25s ease, box-shadow 0.25s ease, transform 0.15s ease, color 0.25s ease;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            background: linear-gradient(135deg, rgba(26, 84, 144, 0.9), rgba(26, 84, 144, 0.7));
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 10px 30px rgba(26, 84, 144, 0.35), inset 0 1px 0 rgba(255, 255, 255, 0.4);
        }

        .btn:hover,
        .btn:focus-visible {
            background: linear-gradient(135deg, rgba(26, 84, 144, 1), rgba(26, 84, 144, 0.85));
            box-shadow: 0 14px 40px rgba(26, 84, 144, 0.45), inset 0 1px 0 rgba(255, 255, 255, 0.6);
            outline: none;
            transform: translateY(-1px);
        }

        .btn:active {
            transform: scale(0.98);
            box-shadow: var(--shadow-sm);
        }

        .btn-secondary {
            background: var(--glass-white);
            color: var(--primary);
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-sm), inset 0 1px 0 rgba(255, 255, 255, 0.5);
        }

        .btn-secondary:hover,
        .btn-secondary:focus-visible {
            background: rgba(255, 255, 255, 0.9);
            box-shadow: var(--shadow-md);
        }

        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(46, 125, 50, 0.9);
            color: white;
            padding: 0.85rem 1.5rem;
            border-radius: 999px;
            font-weight: 600;
            z-index: 2000;
            display: none;
            box-shadow: var(--shadow-md);
            backdrop-filter: blur(18px);
            -webkit-backdrop-filter: blur(18px);
        }

        .toast.show {
            display: block;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        @media (min-width: 768px) {
            .actions-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }

            .action-card {
                min-height: 200px;
            }

            .action-icon {
                width: 100px;
                height: 100px;
            }

            .modal-actions {
                flex-direction: row;
            }

            .btn {
                flex: 1;
            }
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        .springboard {
            max-width: 960px;
            margin: 0 auto;
            padding: 0 1rem 4rem;
        }

        .springboard-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 1rem;
            justify-items: center;
        }

        @media (min-width: 480px) {
            .springboard-grid {
                grid-template-columns: repeat(4, minmax(0, 1fr));
            }
        }

        @media (min-width: 768px) {
            .springboard-grid {
                grid-template-columns: repeat(5, minmax(0, 1fr));
            }
        }

        @media (min-width: 1024px) {
            .springboard-grid {
                grid-template-columns: repeat(6, minmax(0, 1fr));
            }
        }

        .springboard-tile {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: stretch;
        }

        .springboard-tile__button {
            width: 100%;
            min-height: 110px;
            background: var(--glass-white);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem;
            cursor: pointer;
            box-shadow: var(--shadow-md), inset 0 1px 0 rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            transition: border-color 0.25s ease, transform 0.25s ease, box-shadow 0.25s ease, background 0.25s ease;
            contain: layout style paint;
        }

        .springboard-tile__button:focus-visible,
        .springboard-tile__button:hover {
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.8);
            box-shadow: var(--shadow-lg), 0 0 0 1px rgba(255, 255, 255, 0.3), 0 0 0 3px rgba(0, 102, 204, 0.4);
            outline: none;
            transform: translateY(-4px) scale(1.02);
        }

        .springboard-tile__button:active {
            transform: scale(0.98);
            box-shadow: var(--shadow-sm);
        }

        .springboard-tile__icon {
            width: 72px;
            height: 72px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--primary);
            border-radius: 18px;
            background: radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.9), transparent 55%),
                        radial-gradient(circle at 80% 80%, rgba(26, 84, 144, 0.28), transparent 60%);
            box-shadow: 0 4px 18px rgba(0, 0, 0, 0.12);
        }

        .springboard-tile__icon svg,
        .springboard-tile__icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .springboard-tile__label {
            font-size: 0.85rem;
            font-weight: 500;
            text-align: center;
            color: var(--text);
            line-height: 1.3;
        }

        .springboard-tile--folder .springboard-tile__button {
            background: rgba(26, 84, 144, 0.05);
        }

        .folder-sheet {
            position: fixed;
            inset: 0;
            display: none;
            align-items: flex-end;
            justify-content: center;
            z-index: 1100;
        }

        .folder-sheet.open {
            display: flex;
        }

        .folder-sheet__backdrop {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.55);
            backdrop-filter: blur(40px) saturate(180%);
            -webkit-backdrop-filter: blur(40px) saturate(180%);
        }

        .folder-sheet__content {
            position: relative;
            width: 100%;
            background: var(--glass-white-strong);
            border-radius: 24px 24px 0 0;
            padding: 1rem 1.25rem 1.5rem;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            box-shadow: var(--shadow-lg), inset 0 1px 0 rgba(255, 255, 255, 0.7);
            border: 1px solid var(--glass-border);
            transform: translateY(30px);
            opacity: 0;
            transition: transform 260ms cubic-bezier(0.68, -0.55, 0.265, 1.55), opacity 200ms ease-out;
        }

        .folder-sheet.open .folder-sheet__content {
            transform: translateY(0);
            opacity: 1;
        }

        .folder-sheet__header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .folder-sheet__title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text);
            text-shadow: 0 1px 0 rgba(255, 255, 255, 0.8);
        }

        .folder-sheet__close {
            border: none;
            background: transparent;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.25rem;
            line-height: 1;
        }

        .folder-sheet__body {
            overflow-y: auto;
            padding-right: 0.25rem;
        }

        .folder-sheet__grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 0.75rem;
        }

        @media (min-width: 480px) {
            .folder-sheet__grid {
                grid-template-columns: repeat(4, minmax(0, 1fr));
            }
        }

        .folder-sheet__thumb-close {
            width: 100%;
            text-align: center;
        }

        @media (min-width: 768px) {
            .folder-sheet {
                align-items: center;
            }

            .folder-sheet__content {
                border-radius: 16px;
                max-width: 520px;
            }
        }

        .modal-content {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-width: 520px;
            width: 90vw;
        }

        .modal-body {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .modal-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 0.75rem;
            width: 100%;
        }

        .modal-actions .btn {
            width: 100%;
            text-align: center;
        }

        .modal-close-thumb {
            grid-column: 1 / -1;
        }

        @media (max-width: 480px) {
            .modal-qr {
                max-width: 320px;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            .springboard-tile__button,
            .folder-sheet__content,
            .modal-content,
            .modal,
            .folder-sheet {
                transition: none !important;
                transform: none !important;
            }
        }

        @supports not ((backdrop-filter: blur(10px)) or (-webkit-backdrop-filter: blur(10px))) {
            .page-header,
            .springboard-tile__button,
            .folder-sheet__backdrop,
            .folder-sheet__content {
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
            }

            .folder-sheet__backdrop {
                background: rgba(0, 0, 0, 0.65);
            }

            .modal {
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
                background: rgba(0, 0, 0, 0.9);
            }
        }
    </style>
</head>
<body>
    <header class="page-header">
        <h1>Vote Moreau Resources</h1>
        <div class="language-toggle">
            <span class="language-toggle-label">English</span>
            <label class="toggle-switch" aria-label="Toggle language between English and Spanish">
                <input type="checkbox" id="language-toggle" aria-label="Language toggle">
                <span class="toggle-slider"></span>
            </label>
            <span class="language-toggle-label">Español</span>
        </div>
    </header>
    
    <main class="springboard" aria-label="SpringBoard home screen">
        <div class="springboard-grid" id="springboard-grid" role="grid" aria-label="App grid"></div>
    </main>

    <div class="modal" id="modal" role="dialog" aria-labelledby="modal-title" aria-modal="true" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-title"></h2>
                <button class="close-btn" id="close-btn" aria-label="Close modal">×</button>
            </div>
            <div class="modal-qr-container" id="modal-qr-container">
                <img class="modal-qr" id="modal-qr" aria-label="QR code" alt="QR code for selected action" />
            </div>
            <div class="modal-url" id="modal-url" aria-label="URL"></div>
            <div class="modal-actions" role="group" aria-label="QR actions">
                <a href="#" class="btn" id="open-link-btn" target="_blank" rel="noopener" aria-label="Open link">Open Link</a>
                <button class="btn btn-secondary" id="share-link-btn" type="button" aria-label="Share link and QR code">Share</button>
                <button class="btn btn-secondary" id="copy-link-btn" type="button" aria-label="Copy link to clipboard">Copy Link</button>
                <button class="btn btn-secondary" id="download-qr-btn" type="button" aria-label="Download QR code as PNG">Download QR</button>
                <button class="btn btn-secondary modal-close-thumb" id="modal-done-btn" type="button" aria-label="Close QR modal">Done</button>
            </div>
        </div>
    </div>

    <div class="folder-sheet" id="folder-sheet" role="dialog" aria-modal="true" aria-hidden="true">
        <div class="folder-sheet__backdrop"></div>
        <div class="folder-sheet__content" role="document">
            <div class="folder-sheet__header">
                <h2 class="folder-sheet__title" id="folder-title"></h2>
                <button class="folder-sheet__close" id="folder-close-btn" type="button" aria-label="Close folder">×</button>
            </div>
            <div class="folder-sheet__body">
                <div class="folder-sheet__grid" id="folder-grid" role="grid" aria-label="Folder items"></div>
            </div>
            <button class="btn folder-sheet__thumb-close" id="folder-close-thumb" type="button" aria-label="Close folder (thumb button)">Close Folder</button>
        </div>
    </div>

    <div class="toast" id="toast" role="alert" aria-live="polite"></div>

    <script>
        // Check authentication on page load (client-side fallback)
        (function() {
            const cookie = document.cookie;
            const isAuthenticated = cookie.includes('auth_token=authenticated');
            
            if (!isAuthenticated && window.location.pathname !== '/password.html') {
                // Check if we're on the password page or API route
                const path = window.location.pathname;
                if (path !== '/password.html' && !path.startsWith('/api/')) {
                    window.location.href = '/password.html';
                }
            }
        })();

        // QR code generation using a reliable external image service.
        // Each card's URL is encoded directly as the QR payload; the service
        // returns a PNG image whose QR content is that URL.

        // Icon SVG definitions
        const icons = {
            registerEn: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="4" y="3" width="16" height="14" rx="1.5" stroke="currentColor" stroke-width="2"/><path d="M8 11h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M8 15h5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M9.5 17.5l1 2 3-4.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',
            registerEs: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="4" y="3" width="16" height="14" rx="1.5" stroke="currentColor" stroke-width="2"/><path d="M8 11h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M8 15h5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M9.5 17.5l1 2 3-4.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',
            mailEn: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',
            mailEs: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',
            statusEn: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/><path d="M9 12l2 2 4-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',
            statusEs: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/><path d="M9 12l2 2 4-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',
            donateEn: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',
            donateEs: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',
            yardEn: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 3h18v18H3V3z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M7 7h10M7 12h10M7 17h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>',
            yardEs: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 3h18v18H3V3z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M7 7h10M7 12h10M7 17h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>',
            windowEn: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/><path d="M3 9h18M9 3v18" stroke="currentColor" stroke-width="2"/></svg>',
            windowEs: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/><path d="M3 9h18M9 3v18" stroke="currentColor" stroke-width="2"/></svg>',
            volunteerEn: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2"/><path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',
            volunteerEs: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2"/><path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',
            newsletterEn: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><polyline points="22,6 12,13 2,6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',
            newsletterEs: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><polyline points="22,6 12,13 2,6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',
            surveyEn: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',
            surveyEs: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',
            ballotMailEn: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="3" width="18" height="14" rx="2" stroke="currentColor" stroke-width="2"/><path d="M6 6h12v4H6z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M9 13h6v3H9z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M9 16l3 2 3-2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',
            ballotMailEs: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="3" width="18" height="14" rx="2" stroke="currentColor" stroke-width="2"/><path d="M6 6h12v4H6z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M9 13h6v3H9z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M9 16l3 2 3-2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',
            pollingLocationEn: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 21s6-4.11 6-10a6 6 0 10-12 0c0 5.89 6 10 6 10z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="12" cy="9" r="2.5" stroke="currentColor" stroke-width="2"/></svg>',
            pollingLocationEs: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 21s6-4.11 6-10a6 6 0 10-12 0c0 5.89 6 10 6 10z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="12" cy="9" r="2.5" stroke="currentColor" stroke-width="2"/></svg>',
            earlyVotingEn: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="4" y="6" width="16" height="12" rx="2" stroke="currentColor" stroke-width="2"/><path d="M4 12h16M8 6v-1a1 1 0 011-1h6a1 1 0 011 1v1" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>',
            earlyVotingEs: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="4" y="6" width="16" height="12" rx="2" stroke="currentColor" stroke-width="2"/><path d="M4 12h16M8 6v-1a1 1 0 011-1h6a1 1 0 011 1v1" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>',
            ballotAppEn: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="3" width="18" height="14" rx="2" stroke="currentColor" stroke-width="2"/><path d="M7 9h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M9 13h6v3H9z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M9 16l3 2 3-2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',
            ballotAppEs: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="3" width="18" height="14" rx="2" stroke="currentColor" stroke-width="2"/><path d="M7 9h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M9 13h6v3H9z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M9 16l3 2 3-2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',
            facebookEn: '<svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg>',
            facebookEs: '<svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg>',
            instagramEn: '<svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="2" width="20" height="20" rx="5" ry="5" stroke="currentColor" stroke-width="2" fill="none"/><path d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>',
            instagramEs: '<svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="2" width="20" height="20" rx="5" ry="5" stroke="currentColor" stroke-width="2" fill="none"/><path d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>',
            youtubeEn: '<svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M10 8.5l5 3.5-5 3.5V8.5z"/><path d="M6 6h12a4 4 0 014 4v3a4 4 0 01-4 4H6a4 4 0 01-4-4V10a4 4 0 014-4z" fill="none" stroke="currentColor" stroke-width="2"/></svg>',
            youtubeEs: '<svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M10 8.5l5 3.5-5 3.5V8.5z"/><path d="M6 6h12a4 4 0 014 4v3a4 4 0 01-4 4H6a4 4 0 01-4-4V10a4 4 0 014-4z" fill="none" stroke="currentColor" stroke-width="2"/></svg>',
            contactFayetteEn: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="4" y="4" width="16" height="16" rx="3" stroke="currentColor" stroke-width="2"/><path d="M8 9h8M8 13h8M10 7h4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><circle cx="12" cy="17" r="2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>',
            contactFayetteEs: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="4" y="4" width="16" height="16" rx="3" stroke="currentColor" stroke-width="2"/><path d="M8 9h8M8 13h8M10 7h4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><circle cx="12" cy="17" r="2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>',
            contactCraigEn: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="7" y="3" width="10" height="18" rx="3" stroke="currentColor" stroke-width="2"/><rect x="10" y="16" width="4" height="1.5" rx="0.5" fill="currentColor"/><circle cx="12" cy="6" r="1" fill="currentColor"/><path d="M12 11h-2v-2h4v2h-2z" fill="currentColor"/></svg>',
            contactCraigEs: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="7" y="3" width="10" height="18" rx="3" stroke="currentColor" stroke-width="2"/><rect x="10" y="16" width="4" height="1.5" rx="0.5" fill="currentColor"/><circle cx="12" cy="6" r="1" fill="currentColor"/><path d="M12 11h-2v-2h4v2h-2z" fill="currentColor"/></svg>',
            folderInfo: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 7a2 2 0 012-2h4l2 2h8a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V7z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M7 12h10M7 16h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>',
            folderForms: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 7a2 2 0 012-2h4l2 2h8a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V7z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M8 12h8M8 16h5M8 8h2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>',
            folderSocial: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 7a2 2 0 012-2h4l2 2h8a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V7z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="9" cy="13" r="2" stroke="currentColor" stroke-width="2"/><path d="M12 13h3.5a1.5 1.5 0 110 3H12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>',
            folderContacts: '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 7a2 2 0 012-2h4l2 2h8a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V7z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M14 12h4M14 16h4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><circle cx="9" cy="14" r="2" stroke="currentColor" stroke-width="2"/><path d="M5.5 18c.6-1.2 1.9-2 3.5-2s2.9.8 3.5 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>'
        };

        const ICON_BASE_PATH = '/icons';

        function iconKeyToFilename(key) {
            return key
                .replace(/([a-z0-9])([A-Z])/g, '$1-$2')
                .toLowerCase() + '.png';
        }

        function getIconSrc(iconKey) {
            if (!iconKey) return '';
            return `${ICON_BASE_PATH}/${iconKeyToFilename(iconKey)}`;
        }

        const folders = [
            {
                id: 'folder-info',
                category: 'voter-registration',
                icon: 'folderInfo',
                label: {
                    en: 'Information for Voters',
                    es: 'Información para votantes'
                }
            },
            {
                id: 'folder-forms',
                category: 'forms',
                icon: 'folderForms',
                label: {
                    en: 'Forms & Requests',
                    es: 'Formularios y solicitudes'
                }
            },
            {
                id: 'folder-social',
                category: 'social',
                icon: 'folderSocial',
                label: {
                    en: 'Social Media',
                    es: 'Redes sociales'
                }
            },
            {
                id: 'folder-contacts',
                category: 'contacts',
                icon: 'folderContacts',
                label: {
                    en: 'Contacts & Offices',
                    es: 'Contactos y oficinas'
                }
            }
        ];

        // Application code
        const actions = [
            // Voter registration
            { label: 'Register or Update Voter Registration', url: 'https://www.votetexas.gov/register-to-vote/update-voter-registration.html', lang: 'en', icon: 'registerEn', category: 'voter-registration' },
            { label: 'Registrar o Actualizar Registro de Votantes', url: 'https://www.votetexas.gov/es/registrese-para-votar/como-registrarse-o-actualizar-su-informacion-de-registro.html', lang: 'es', icon: 'registerEs', category: 'voter-registration' },
            { label: 'Request for Postage-Paid Voter Registration', url: 'https://vrrequest.sos.texas.gov/VoterRegistration/AddRequestEN', lang: 'en', icon: 'mailEn', category: 'voter-registration' },
            { label: 'Solicitud de Registro de Votantes Prepagado', url: 'https://vrrequest.sos.texas.gov/VoterRegistration/AddRequestES', lang: 'es', icon: 'mailEs', category: 'voter-registration' },
            { label: 'Check Voter Registration Status', url: 'https://goelect.txelections.civixapps.com/ivis-mvp-ui/#/login', lang: 'en', icon: 'statusEn', category: 'voter-registration' },
            { label: '¿Estoy registrado/a?', url: 'https://www.votetexas.gov/es/registrese-para-votar/index.htm', lang: 'es', icon: 'statusEs', category: 'voter-registration' },
            { label: 'Polling Locations (Coming Soon)', url: 'https://votemoreau.com', lang: 'en', icon: 'pollingLocationEn', category: 'voter-registration', id: 'polling-locations-coming-soon' },
            { label: 'Lugares de Votación (Próximamente)', url: 'https://votemoreau.com', lang: 'es', icon: 'pollingLocationEs', category: 'voter-registration', id: 'lugares-de-votacion-proximamente' },
            { label: 'Early Voting Locations (Coming Soon)', url: 'https://votemoreau.com', lang: 'en', icon: 'earlyVotingEn', category: 'voter-registration', id: 'early-voting-locations-coming-soon' },
            { label: 'Ubicaciones de Votación Anticipada (Próximamente)', url: 'https://votemoreau.com', lang: 'es', icon: 'earlyVotingEs', category: 'voter-registration', id: 'ubicaciones-de-votacion-anticipada-proximamente' },
            { label: 'Application for a Ballot by Mail', url: 'https://vrrequest.sos.texas.gov/Ballot/AddRequestEN', lang: 'en', icon: 'ballotAppEn', category: 'voter-registration', id: 'application-for-ballot-by-mail-en' },
            { label: 'Solicitud de Aplicación de Boleta por Correo', url: 'https://vrrequest.sos.texas.gov/Ballot/AddRequestES', lang: 'es', icon: 'ballotAppEs', category: 'voter-registration', id: 'solicitud-de-aplicacion-de-boleta-por-correo-es' },

            // Forms & requests
            { label: 'Donate to Campaign', url: 'https://form.jotform.com/253327107429052', lang: 'en', icon: 'donateEn', category: 'forms' },
            { label: 'Donar a la Campaña', url: 'https://form.jotform.com/253327107429052', lang: 'es', icon: 'donateEs', category: 'forms' },
            { label: 'Request Yard Sign', url: 'https://form.jotform.com/253325937266060', lang: 'en', icon: 'yardEn', category: 'forms' },
            { label: 'Solicitar Letrero de Jardín', url: 'https://form.jotform.com/253325937266060', lang: 'es', icon: 'yardEs', category: 'forms' },
            { label: 'Request Window Display Sign', url: 'https://form.jotform.com/253326570216150', lang: 'en', icon: 'windowEn', category: 'forms' },
            { label: 'Solicitar Letrero para Ventana', url: 'https://form.jotform.com/253326570216150', lang: 'es', icon: 'windowEs', category: 'forms' },
            { label: 'Apply to Volunteer', url: 'https://form.jotform.com/253277644615160', lang: 'en', icon: 'volunteerEn', category: 'forms' },
            { label: 'Aplicar para Ser Voluntario', url: 'https://form.jotform.com/253277644615160', lang: 'es', icon: 'volunteerEs', category: 'forms' },
            { label: 'Subscribe to Weekly Newsletter', url: 'https://form.jotform.com/253328242016045', lang: 'en', icon: 'newsletterEn', category: 'forms' },
            { label: 'Suscribirse al Boletín Semanal', url: 'https://form.jotform.com/253328242016045', lang: 'es', icon: 'newsletterEs', category: 'forms' },
            { label: 'Constituent Survey', url: 'https://form.jotform.com/253328352767060', lang: 'en', icon: 'surveyEn', category: 'forms' },
            { label: 'Encuesta de Constituyentes', url: 'https://form.jotform.com/253328352767060', lang: 'es', icon: 'surveyEs', category: 'forms' },
            { label: 'Request Ballot by Mail', url: 'https://vrrequest.sos.texas.gov/Ballot/AddRequestEN', lang: 'en', icon: 'ballotMailEn', category: 'voter-registration', id: 'request-ballot-by-mail-en' },
            { label: 'Solicitud de Boleta por Correo', url: 'https://vrrequest.sos.texas.gov/Ballot/AddRequestEN', lang: 'es', icon: 'ballotMailEs', category: 'voter-registration', id: 'solicitud-de-boleta-por-correo-es' },

            // Social media
            { label: 'Follow on Facebook', url: 'https://www.facebook.com/moreau4judge', lang: 'en', icon: 'facebookEn', category: 'social' },
            { label: 'Seguir en Facebook', url: 'https://www.facebook.com/moreau4judge', lang: 'es', icon: 'facebookEs', category: 'social' },
            { label: 'Follow on Instagram', url: 'https://www.instagram.com/moreau4judge/', lang: 'en', icon: 'instagramEn', category: 'social' },
            { label: 'Seguir en Instagram', url: 'https://www.instagram.com/moreau4judge/', lang: 'es', icon: 'instagramEs', category: 'social' },
            { label: 'Moreau on YouTube', url: 'https://www.youtube.com/channel/UCuAXFkgsw1L7xaCfnd5JJOw', lang: 'en', icon: 'youtubeEn', category: 'social' },
            { label: 'Moreau en YouTube', url: 'https://www.youtube.com/channel/UCuAXFkgsw1L7xaCfnd5JJOw', lang: 'es', icon: 'youtubeEs', category: 'social' },

            // Contacts & offices
            { label: 'Fayette County Elections Office', url: '/fayette.vcf', lang: 'en', icon: 'contactFayetteEn', category: 'contacts' },
            { label: 'Oficina Electoral del Condado de Fayette', url: '/fayette.vcf', lang: 'es', icon: 'contactFayetteEs', category: 'contacts' },
            { label: 'Add Craig to Contacts', url: '/craigmoreau.vcf', lang: 'en', icon: 'contactCraigEn', category: 'contacts' },
            { label: 'Agregar a Contactos', url: '/craigmoreau.vcf', lang: 'es', icon: 'contactCraigEs', category: 'contacts' }
        ];

        const springboardGrid = document.getElementById('springboard-grid');
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modal-title');
        const modalQr = document.getElementById('modal-qr');
        const modalUrl = document.getElementById('modal-url');
        const openLinkBtn = document.getElementById('open-link-btn');
        const shareLinkBtn = document.getElementById('share-link-btn');
        const copyLinkBtn = document.getElementById('copy-link-btn');
        const downloadQrBtn = document.getElementById('download-qr-btn');
        const modalDoneBtn = document.getElementById('modal-done-btn');
        const closeBtn = document.getElementById('close-btn');
        const toast = document.getElementById('toast');
        const languageToggle = document.getElementById('language-toggle');
        const folderSheet = document.getElementById('folder-sheet');
        const folderTitle = document.getElementById('folder-title');
        const folderGrid = document.getElementById('folder-grid');
        const folderCloseBtn = document.getElementById('folder-close-btn');
        const folderDoneBtn = document.getElementById('folder-close-thumb');
        
        // Get saved language preference or default to English
        let currentLanguage = localStorage.getItem('preferredLanguage') || 'en';
        languageToggle.checked = currentLanguage === 'es';

        let currentAction = null;
        let focusableElements = [];
        let firstFocusable = null;
        let lastFocusable = null;
        let lastFocusTrigger = null;
        let currentFolder = null;
        let folderFocusableElements = [];
        let firstFolderFocusable = null;
        let lastFolderFocusable = null;

        // Wrapper for generating QR images for a given URL.
        // Uses an external QR code image service that encodes the URL as the QR payload.
        // - url: string that will be encoded in the QR
        // - imgElement: target <img> element (visible in the modal)
        // - options.size: output size in pixels (image will be size x size)
        const QR_CANONICAL_ORIGIN = 'https://engage.votemoreau.com';

        function resolveUrlForAction(action) {
            if (action.url.startsWith('http://') || action.url.startsWith('https://')) {
                return action.url;
            }
            if (action.url.startsWith('//')) {
                return `https:${action.url}`;
            }
            return `${QR_CANONICAL_ORIGIN}${action.url}`;
        }

        function generateQRCodeForUrl(url, imgElement, options = {}) {
            const size = options.size || 400; // on-screen default
            const clampedSize = Math.max(150, Math.min(size, 1000));
            const encoded = encodeURIComponent(url);
            const src = `https://api.qrserver.com/v1/create-qr-code/?size=${clampedSize}x${clampedSize}&data=${encoded}&margin=4`;

            imgElement.src = src;
            imgElement.width = clampedSize;
            imgElement.height = clampedSize;
        }

        // Build a unique QR payload string for a given card action.
        // This stays stable for that card even if multiple cards share the same
        // destination URL today, by appending a fragment with a per-card id.
        // Scanners will see a unique URL, but servers ignore the fragment.
        function slugifyForId(label) {
            return label
                .toLowerCase()
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/^-+|-+$/g, '');
        }

        function getQrPayloadForAction(action) {
            const base = resolveUrlForAction(action);
            const rawId = action.id || slugifyForId(action.label) || 'card';
            const id = rawId.toLowerCase();

            // If the URL already has a fragment, just append a dash + id.
            if (base.includes('#')) {
                return `${base}-${id}`;
            }

            // Otherwise, add a #card-<id> fragment. This makes the QR content
            // unique per card, but the request to the external site is the same.
            return `${base}#card-${id}`;
        }

        function getFolderLabel(folder) {
            return folder.label[currentLanguage] || folder.label.en;
        }

        function getLocalizedActions(filterFn = () => true) {
            return actions.filter(action => action.lang === currentLanguage && filterFn(action));
        }

        function renderSpringboard() {
            springboardGrid.innerHTML = '';
            springboardGrid.setAttribute('aria-busy', 'true');

            folders.forEach(folder => {
                const folderTile = createFolderTile(folder);
                springboardGrid.appendChild(folderTile);
            });

            const looseActions = getLocalizedActions(action => !folders.some(folder => folder.category === action.category));
            looseActions.forEach(action => {
                springboardGrid.appendChild(createActionTile(action));
            });

            springboardGrid.setAttribute('aria-busy', 'false');
        }

        function createFolderTile(folder) {
            const label = getFolderLabel(folder);
            const iconSrc = getIconSrc(folder.icon);
            const tile = document.createElement('div');
            tile.className = 'springboard-tile springboard-tile--folder';
            tile.setAttribute('role', 'gridcell');

            const button = document.createElement('button');
            button.className = 'springboard-tile__button';
            button.type = 'button';
            button.setAttribute('aria-label', label);
            button.dataset.folderId = folder.id;
            button.innerHTML = `
                <div class="springboard-tile__icon" aria-hidden="true">
                    ${iconSrc ? `<img src="${iconSrc}" alt="" loading="lazy" />` : ''}
                </div>
                <div class="springboard-tile__label">${label}</div>
            `;
            button.addEventListener('click', () => openFolder(folder, button));

            tile.appendChild(button);
            return tile;
        }

        function createActionTile(action) {
            const iconSrc = getIconSrc(action.icon);
            const tile = document.createElement('div');
            tile.className = 'springboard-tile';
            tile.setAttribute('role', 'gridcell');

            const button = document.createElement('button');
            button.className = 'springboard-tile__button';
            button.type = 'button';
            button.setAttribute('aria-label', action.label);
            button.innerHTML = `
                <div class="springboard-tile__icon" aria-hidden="true">
                    ${iconSrc ? `<img src="${iconSrc}" alt="" loading="lazy" />` : ''}
                </div>
                <div class="springboard-tile__label">${action.label}</div>
            `;
            button.addEventListener('click', () => handleActionSelect(action, button));

            tile.appendChild(button);
            return tile;
        }

        function handleActionSelect(action, trigger) {
            let originButton = trigger;
            if (folderSheet.classList.contains('open') && currentFolder) {
                const folderButton = springboardGrid.querySelector(`[data-folder-id="${currentFolder.id}"]`);
                if (folderButton) {
                    originButton = folderButton;
                }
                closeFolder({ returnFocus: false });
            }
            lastFocusTrigger = originButton;
            openModal(action);
        }

        function openFolder(folder, trigger) {
            currentFolder = folder;
            lastFocusTrigger = trigger;
            folderTitle.textContent = getFolderLabel(folder);
            const closeLabel = currentLanguage === 'es' ? 'Cerrar carpeta' : 'Close folder';
            folderCloseBtn.setAttribute('aria-label', closeLabel);
            folderDoneBtn.textContent = closeLabel;
            folderDoneBtn.setAttribute('aria-label', closeLabel);
            folderGrid.innerHTML = '';
            const folderActions = getLocalizedActions(action => action.category === folder.category);

            if (folderActions.length === 0) {
                const emptyState = document.createElement('p');
                emptyState.textContent = currentLanguage === 'es' ? 'No hay elementos en esta carpeta.' : 'No items in this folder yet.';
                folderGrid.appendChild(emptyState);
            } else {
                folderActions.forEach(action => {
                    folderGrid.appendChild(createActionTile(action));
                });
            }

            folderSheet.classList.add('open');
            folderSheet.setAttribute('aria-hidden', 'false');
            document.body.style.overflow = 'hidden';

            folderFocusableElements = folderSheet.querySelectorAll(
                'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
            firstFolderFocusable = folderFocusableElements[0];
            lastFolderFocusable = folderFocusableElements[folderFocusableElements.length - 1];
            setTimeout(() => firstFolderFocusable && firstFolderFocusable.focus(), 100);
        }

        function closeFolder({ returnFocus = true } = {}) {
            if (!folderSheet.classList.contains('open')) return;

            folderSheet.classList.remove('open');
            folderSheet.setAttribute('aria-hidden', 'true');
            folderGrid.innerHTML = '';
            currentFolder = null;
            folderFocusableElements = [];
            document.body.style.overflow = modal.classList.contains('active') ? 'hidden' : '';

            if (returnFocus && lastFocusTrigger) {
                lastFocusTrigger.focus();
            }
        }

        function openModal(action) {
            currentAction = action;
            modalTitle.textContent = action.label;
            modalUrl.textContent = action.url;
            openLinkBtn.href = action.url;
            const doneLabel = currentLanguage === 'es' ? 'Listo' : 'Done';
            modalDoneBtn.textContent = doneLabel;
            modalDoneBtn.setAttribute('aria-label', doneLabel);
            
            const viewportWidth = window.innerWidth;
            const qrSize = Math.min(Math.floor(viewportWidth * 0.9), 400);
            // On-screen QR: responsive up to 400px for fast scanning.
            // Use a per-card QR payload so each card has a unique, stable QR.
            const qrPayload = getQrPayloadForAction(action);
            generateQRCodeForUrl(qrPayload, modalQr, { size: qrSize });
            
            modal.classList.add('active');
            modal.setAttribute('aria-hidden', 'false');
            
            // Focus trap setup
            focusableElements = modal.querySelectorAll(
                'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
            firstFocusable = focusableElements[0];
            lastFocusable = focusableElements[focusableElements.length - 1];
            
            // Focus first element
            setTimeout(() => firstFocusable.focus(), 100);
            
            // Prevent body scroll
            document.body.style.overflow = 'hidden';
        }

        function closeModal({ returnFocus = true } = {}) {
            if (!modal.classList.contains('active')) return;

            modal.classList.remove('active');
            modal.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = folderSheet.classList.contains('open') ? 'hidden' : '';
            currentAction = null;

            if (returnFocus && lastFocusTrigger) {
                lastFocusTrigger.focus();
            }
        }

        function showToast(message) {
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function copyToClipboard(text) {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                return navigator.clipboard.writeText(text).then(() => true);
            } else {
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    const success = document.execCommand('copy');
                    document.body.removeChild(textarea);
                    return Promise.resolve(success);
                } catch (err) {
                    document.body.removeChild(textarea);
                    return Promise.resolve(false);
                }
            }
        }

        function downloadQR() {
            if (!currentAction) return;

            // Use a high-resolution QR image from the external service for printing.
            // The payload matches the on-screen QR (unique per card).
            const size = 1024;
            const qrPayload = getQrPayloadForAction(currentAction);
            const encoded = encodeURIComponent(qrPayload);
            const downloadUrl = `https://api.qrserver.com/v1/create-qr-code/?size=${size}x${size}&data=${encoded}&margin=4`;

            const link = document.createElement('a');
            link.download = `qr-${currentAction.label.replace(/[^a-z0-9]/gi, '-').toLowerCase()}.png`;
            link.href = downloadUrl;
            link.click();
        }

        // Event listeners
        closeBtn.addEventListener('click', () => closeModal());
        modalDoneBtn.addEventListener('click', () => closeModal());
        
        openLinkBtn.addEventListener('click', (e) => {
            e.preventDefault();
            if (currentAction) {
                window.open(currentAction.url, '_blank', 'noopener');
            }
        });

        shareLinkBtn.addEventListener('click', async () => {
            if (!currentAction) return;
            const shareText = `Check out this action: ${currentAction.url}`;
            const sharePayload = {
                title: currentAction.label,
                text: shareText,
                url: currentAction.url
            };

            if (navigator.share) {
                try {
                    await navigator.share(sharePayload);
                    showToast('Share dialog opened');
                    return;
                } catch (error) {
                    console.error('Share failed', error);
                }
            }

            copyToClipboard(currentAction.url).then((success) => {
                if (success) {
                    showToast('Link copied to clipboard! Use it to share.');
                } else {
                    showToast('Unable to share link');
                }
            });
        });

        copyLinkBtn.addEventListener('click', () => {
            if (currentAction) {
                copyToClipboard(currentAction.url).then((success) => {
                    if (success) {
                        showToast('Link copied to clipboard!');
                    } else {
                        showToast('Failed to copy link');
                    }
                });
            }
        });

        downloadQrBtn.addEventListener('click', downloadQR);
        folderCloseBtn.addEventListener('click', () => closeFolder());
        folderDoneBtn.addEventListener('click', () => closeFolder());
        folderSheet.querySelector('.folder-sheet__backdrop').addEventListener('click', () => closeFolder());

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (modal.classList.contains('active')) {
                if (e.key === 'Escape') {
                    closeModal();
                } else if (e.key === 'Tab' && focusableElements.length) {
                    if (e.shiftKey) {
                        if (document.activeElement === firstFocusable) {
                            e.preventDefault();
                            lastFocusable.focus();
                        }
                    } else if (document.activeElement === lastFocusable) {
                        e.preventDefault();
                        firstFocusable.focus();
                    }
                }
                return;
            }

            if (folderSheet.classList.contains('open')) {
                if (e.key === 'Escape') {
                    closeFolder();
                } else if (e.key === 'Tab' && folderFocusableElements.length) {
                    if (e.shiftKey) {
                        if (document.activeElement === firstFolderFocusable) {
                            e.preventDefault();
                            lastFolderFocusable.focus();
                        }
                    } else if (document.activeElement === lastFolderFocusable) {
                        e.preventDefault();
                        firstFolderFocusable.focus();
                    }
                }
            }
        });

        // Pinch-to-zoom support (touch events)
        let initialDistance = 0;
        let initialScale = 1;
        let currentScale = 1;

        modalQr.addEventListener('touchstart', (e) => {
            if (e.touches.length === 2) {
                e.preventDefault();
                const touch1 = e.touches[0];
                const touch2 = e.touches[1];
                initialDistance = Math.hypot(
                    touch2.clientX - touch1.clientX,
                    touch2.clientY - touch1.clientY
                );
                initialScale = currentScale;
            }
        });

        modalQr.addEventListener('touchmove', (e) => {
            if (e.touches.length === 2) {
                e.preventDefault();
                const touch1 = e.touches[0];
                const touch2 = e.touches[1];
                const currentDistance = Math.hypot(
                    touch2.clientX - touch1.clientX,
                    touch2.clientY - touch1.clientY
                );
                currentScale = initialScale * (currentDistance / initialDistance);
                currentScale = Math.max(1, Math.min(currentScale, 3));
                modalQr.style.transform = `scale(${currentScale})`;
            }
        });

        modalQr.addEventListener('touchend', () => {
            if (currentScale < 1.1) {
                currentScale = 1;
                modalQr.style.transform = 'scale(1)';
            }
        });

        // Language toggle event listener
        languageToggle.addEventListener('change', (e) => {
            currentLanguage = e.target.checked ? 'es' : 'en';
            localStorage.setItem('preferredLanguage', currentLanguage);
            renderSpringboard();

            if (folderSheet.classList.contains('open')) {
                closeFolder({ returnFocus: false });
            }

            if (modal.classList.contains('active')) {
                closeModal({ returnFocus: false });
            }
        });

        // Initialize
        renderSpringboard();
    </script>
</body>
</html>

